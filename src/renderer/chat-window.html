<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control - Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f7f7f8;
            --bg-tertiary: #ececec;
            --text-primary: #0d0d0d;
            --text-secondary: #6b6b6b;
            --text-muted: #999999;
            --border-color: #e5e5e5;
            --accent-color: #0d0d0d;
            --user-bubble: #0d0d0d;
            --user-text: #ffffff;
            --ai-bubble: #f7f7f8;
            --ai-text: #0d0d0d;
            --action-bg: #f0f4ff;
            --action-border: #d0dcff;
            --success-color: #10b981;
            --error-color: #ef4444;
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent !important;
        }

        body {
            /* background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%); */
            /* backdrop-filter: blur(20px); */
            /* background-color: transparent; */
            /* border: black solid 10px;
            border-radius: 50px; */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #000000;
            overflow: hidden;
            -webkit-app-region: no-drag;
        }

        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            /* border: black solid 10px; */
            border-radius: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%);
            /* background-color: blue; */
            backdrop-filter: blur(20px);
            overflow: hidden;

        }


        .chat-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 12px 16px;
            background: var(--bg-primary);
            /* background-color: red; */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            -webkit-app-region: drag;
            -webkit-user-select: none;
            user-select: none;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            -webkit-app-region: no-drag;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background: var(--accent-color);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }


        .mode-toggle {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 3px;
            gap: 2px;
            -webkit-app-region: no-drag;
        }

        .mode-btn {
            padding: 6px 14px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 18px;
            transition: all 0.2s ease;
            -webkit-app-region: no-drag;
        }

        .mode-btn.active {
            background: var(--accent-color);
            color: white;
        }

        .mode-btn:hover:not(.active) {
            background: var(--bg-tertiary);
        }

        .header-actions {
            display: flex;
            gap: 4px;
            -webkit-app-region: no-drag;
        }

        .header-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            font-size: 14px;
        }

        .header-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-top: 70px;
            padding-bottom: 140px;
            -webkit-app-region: no-drag;
            background: var(--bg-primary);
        }

        .message {
            margin-bottom: 16px;
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 96%;
            padding: 12px 16px;
            margin-left: 2%;
            margin-right: 2%;
            font-size: 14px;
            line-height: 1.6;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: var(--user-bubble);
            color: var(--user-text);
            border-radius: var(--radius-md) var(--radius-md) 4px var(--radius-md);
        }

        .message.ai .message-content {
            background: var(--ai-bubble);
            color: var(--ai-text);
            border-radius: var(--radius-md) var(--radius-md) var(--radius-md) 4px;
        }

        .message.action .message-content {
            background: var(--action-bg);
            border: 1px solid var(--action-border);
            border-radius: var(--radius-sm);
            padding: 12px 14px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 13px;
            color: var(--text-secondary);
            width: 96%;
            margin-left: 2%;
            margin-right: 2%;
        }

        .action-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .action-details {
            padding-left: 0;
            font-size: 12px;
            opacity: 0.8;
            white-space: pre-wrap;
            margin-top: 4px;
            max-height: 300px;
            overflow-y: auto;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
        }

        .action-details.collapsed {
            max-height: 0;
            opacity: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .action-toggle {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0 4px;
            font-size: 12px;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-toggle:hover {
            color: var(--text-primary);
        }

        .action-toggle.collapsed {
            transform: rotate(-90deg);
        }

        .action-icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .action-success {
            color: var(--success-color);
        }

        .action-error {
            color: var(--error-color);
        }

        /* Attachments */
        .attachments-container {
            padding: 8px 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            -webkit-app-region: no-drag;
        }

        .attachments-container:empty {
            display: none;
        }

        .attachment-pill {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            white-space: nowrap;
        }

        .attachment-remove {
            background: transparent;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            padding: 0;
            font-size: 14px;
        }

        /* Input Area */
        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 12px 16px 16px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-color);
            -webkit-app-region: no-drag;
            z-index: 100;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 8px 12px;
            transition: border-color 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-color);
        }

        .input-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            font-size: 14px;
        }

        .input-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .input-btn.recording {
            background: var(--error-color);
            color: white;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .chat-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            font-family: inherit;
            padding: 6px 8px;
            resize: none;
            max-height: 120px;
            min-height: 24px;
            line-height: 1.5;
            overflow: hidden;
            /* Hide scrollbar */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .chat-input::-webkit-scrollbar {
            display: none;
            /* Hide scrollbar for Chrome, Safari and Opera */
        }

        .chat-input::placeholder {
            color: var(--text-muted);
        }

        .send-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            font-size: 14px;
        }

        .send-btn:hover:not(:disabled) {
            opacity: 0.85;
        }

        .send-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .send-btn.stop {
            background: var(--error-color);
        }

        /* Status indicator (Now under input) */
        .status-bar-min {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 8px;
            opacity: 0.8;
        }

        .status-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--success-color);
            transition: all 0.3s ease;
        }

        .status-text {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .rate-limit-container {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 8px;
            padding-left: 8px;
            border-left: 1px solid var(--border-color);
            height: 12px;
            opacity: 0.7;
        }

        .rate-limit-bar {
            width: 40px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .rate-limit-progress {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .rate-limit-text {
            font-size: 9px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .rate-limit-infinity {
            font-size: 14px;
            line-height: 1;
            margin-top: -2px;
        }

        /* Status Bar (Keep for other uses if needed, but we'll hide it for now) */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 4px 16px;
            background: var(--bg-secondary);
            font-size: 11px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            transform: translateY(100%);
        }

        /* Scrollbar */
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Code blocks in messages */
        .message-content pre {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: var(--radius-sm);
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            margin: 8px 0;
        }

        .message-content code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .message-content pre code {
            background: none;
            padding: 0;
        }

        /* Welcome Screen */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 140px;
            /* Leave space for input container at bottom */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            background: var(--bg-primary);
            z-index: 1;
            pointer-events: none;
        }

        .welcome-screen * {
            pointer-events: auto;
        }

        .welcome-logo {
            width: 80px;
            height: 80px;
            background-image: url('../../assets/icons/icon-removebg-preview.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: welcomePop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .welcome-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 20px;
        }

        @keyframes welcomePop {
            from {
                transform: scale(0.5);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .welcome-greeting {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .welcome-subtext {
            font-size: 14px;
            color: var(--text-secondary);
            max-width: 240px;
            line-height: 1.5;
        }

        .welcome-hidden {
            display: none !important;
        }

        /* Messages container positioning for welcome screen */
        .messages-container {
            position: relative;
        }

        /* Ensure welcome screen is visible by default */
        #welcomeScreen:not(.welcome-hidden) {
            display: flex !important;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #374151;
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 13px;
            z-index: 10001;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
            pointer-events: none;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: #10b981;
        }

        .toast.error {
            background: #ef4444;
        }

        .toast.warning {
            background: #f59e0b;
        }

        .toast.info {
            background: #3b82f6;
        }

        /* Message attachments display */
        .message-attachment {
            margin-top: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
        }

        .message-attachment img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            object-fit: contain;
        }

        .message-attachment-file {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
        }

        .message-attachment-file i {
            font-size: 20px;
            color: var(--text-secondary);
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="header-left">
                <!-- <div class="logo-icon">
                    <i class="fas fa-bolt"></i>
                </div> -->
                <div class="mode-toggle">
                    <button class="mode-btn active" id="modeAct" data-mode="act">ACT</button>
                    <button class="mode-btn" id="modeAsk" data-mode="ask">ASK</button>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="newChatButton" title="New chat">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="header-btn" id="historyButton" title="History">
                    <i class="fas fa-clock-rotate-left"></i>
                </button>
                <button class="header-btn" id="settingsButton" title="Settings">
                    <i class="fas fa-gear"></i>
                </button>
            </div>
        </div>

        <!-- Messages -->
        <div class="messages-container" id="messagesContainer">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="welcome-screen">
                <div class="welcome-logo">
                    <img src="../../assets/icons/icon-removebg-preview.png" alt="Control Logo" />
                </div>
                <h1 id="welcomeGreeting" class="welcome-greeting">Hello</h1>
                <p class="welcome-subtext">How can I help you take control of your tasks today?</p>
            </div>
        </div>

        <!-- Input -->
        <div class="input-container">
            <!-- Attachments (displayed above input, inside container) -->
            <div class="attachments-container" id="attachmentsContainer"></div>
            <div class="input-wrapper">
                <button class="input-btn" id="attachButton" title="Attach file">
                    <i class="fas fa-paperclip"></i>
                </button>
                <textarea class="chat-input" id="chatInput" placeholder="Message Control..." rows="1"></textarea>
                <button class="input-btn" id="voiceButton" title="Voice input">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="send-btn" id="sendButton" title="Send" disabled>
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
            <div id="statusIndicator" class="status-bar-min">
                <div id="statusContent" style="display: flex; align-items: center; gap: 6px;">
                    <div id="statusDot" class="status-dot"></div>
                    <span id="statusText" class="status-text">Ready</span>
                </div>
                <!-- Rate Limit Display (Hidden by default, shown via JS) -->
                <div id="rateLimitContainer" class="rate-limit-container" style="display: none;">
                    <div class="rate-limit-bar">
                        <div id="rateLimitProgress" class="rate-limit-progress"></div>
                    </div>
                    <span id="rateLimitText" class="rate-limit-text">0/10</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script src="chat-window.js"></script>
</body>

</html>


<!-- python -c "import pyautogui;pyautogui.FAILSAFE=False;pyautogui.moveTo(0,0);pyautogui.dragTo(500,500,duration=1.0,button='left')" -->

<!-- 



make the settings that say autosend after wakeword to begin recording when the user uses the wakeword and auto send after 5 second of no audio this should also work if the app is already open and the wakeword is said 
also make it that the cached settings and cached account should still be fetched even if offline 

wait for pin to be inputed before speaking greetings (if pin activated)
the entry modal should not open until the entire control has been integrated not immefdiately its created
make the modals draggable i heard z-index messes with it (but if you remove the z index then most of the component will not even show at all) 

for all act backends
- system os type should be sent to the ai so it knows how to navigate itself 
- create openrouter alternative for the both backend but dont link it also create a terminal use code for the four of them so i dont have to use the gui to access them (act(current:gemini), ask(current:gemini), act(openrouter) , ask(openrouter)) 
- it should not move the mouse to 0,0 on start 
- the analyse ui should not return all the element listings analyse ui is supposed to be a mechanism for the ai to look at the screenshot itself and calculate the locationof the element it identifies not returning all the elements
- ensure that the ai is not limited to just a set of actions while using pyautogui i.e it should always pass correct pyautogui strings(to perform tasks) to an execute function that automatically runs the command 
- next one is a bit complex but i will needyou to let the ai be able to call an human in the loop function for dangreous tasks and of course the user will be able to turn this off or on in settings such that for high risk actions the ai will have to ask the user in a cutom message whether to accept action (while stating the action) accept or ignore
- the ai should be able to make plans and make decisions in order to perform tasks to the user satisfaction thats why it is agentic 
- update the system prompt perfectly (as a computer-use / gui Agent) and grade it 
- refine the ai to know when to user terminal scripts and when to use pyautogui 
- update the code to reduce latency 

for the entire app 
- create plans to implemrnt rate limiting based on plan which is be included in the settings (free, pro , master) and also a counter of task left .....(free:10 per week .. pro:200 per week.... master:unlimited )  
- ensure the number of tasks per user is stored in the database(firebase) 


-also make the entry page  also show the internet connectivity of the entire application so that the users know whether they are online or not 
- make the windowvisibility false on default 
- make the app start on system startup (create a setting for this too)
- ensure human in the loop is implemented for dangerous tasks
- implement rate limiting based on plan (free, pro , master) and also a counter of task left .....(free:10 per week .. pro:200 per week.... master:unlimited )  
- ensure the number of tasks per user is stored in the database(firebase)
- ensure the backend works as planned 
- the storing of cached settings and cached account should still be fetched even if offline
- check to ensure that the ai response is well interpreted and executed and displayed in the chat window 
- refine the prompt to narrow the ai pov down to being a computer gui agent only
- remove 89% of comments and leave 11% of highly important comments